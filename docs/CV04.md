# CV04 – Rest API & Spring Security

---

## Předpoklady

- Znalost jazyka Java a OOP (minimálně Java 1.8, doporučená verze Java 17 LTS nebo 21 LTS).
- Verzovací systém Git (orientace v GitHub nebo GitLab výhodou).
- Pokročilejší orientace v modernějším IDE.
- Relační databáze a základy jazyka SQL.
- Funkční Docker (ideálně s Docker Desktop).
- Orientace a znalost pojmů v oblasti IT security.

---

## Výstupy

---

- Úkoly označené ![AI](https://img.shields.io/badge/AI-yellow) řešte pomocí umělé inteligence.
- Použitý **prompt** uložte do souboru **CV04.prompts.txt** do složky **prompts**.
- Do souboru zároveň zaznamenejte **použitou AI službu**.
- Alespoň **jeden prompt** ověřte na pravdivost. K tomuto promptu vložte **odkaz**, podle kterého jste pravdivost ověřili.
- **Pokud používáte AI copilota**, prompt zanechte v **dokumentačním komentáři** v kódu s anotací `@CVNPrompt` na prvním řádku.

---

## Zadání

Realizujte následující úkoly:

Pro každý nový endpoint dodržujte [best practices pro REST](https://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api):

- HTTP metody podle účelu endpointu
- Korektní názvy endpointů
- Korektní HTTP kódy
- Opatřete všechny endpointy verzováním (V1)
- Response vraťte jako DTO.

---

### 1. Přidání uživatele

- Upravte `application.properties` tak aby se při restartu aplikace schéma znovu vytvořilo bez dat.
```
spring.jpa.hibernate.ddl-auto=create-drop
```
Vytvořte nový endpoint pro přidání uživatele do databáze.

### 2. Aplikace REST best practices

Aplikujte REST best practices na všechny GET endpointy.

### 3. Smazání uživatele

Vytvořte nový endpoint pro smazání uživatele podle id.

### 4. Aktualizace uživatele ![AI](https://img.shields.io/badge/AI-yellow)

Pomocí AI vytvořte endpoint pro aktualizaci uživatele podle id. Výstup zvalidujte.

- Upravte `application.properties` zpět na původní hodnotu.
```
spring.jpa.hibernate.ddl-auto=update
```

### 6. Spring Security ![AI](https://img.shields.io/badge/AI-yellow)

- Použijte AI jako asistenta pro implementaci Spring Security. Definujte promptu roli, poskytněte dostatek kontextu o projektu. **Nechte si nejprve zpracovat plán implementace** a pak postupně jednotlivé kroky aplikujte. Nechte si výstup vždy vysvětlit a průběžně jej validujte.

- Přidejte do projektu následující závislosti:
  - **Spring Security**

- Implementujte do projektu autentizaci uživatelů JWT tokeny.
- Vytvořte endpoint pro přihlášení uživatele, který následně vygeneruje JWT token.
- Zabezpečte `PUT` a `DELETE` endpointy autentifikací. Autorizaci implementujte až v semestrální práci.
  - V těle metod kontrolerů nesmí být žádný kód související s autentizací.
  - JWT token musí být při autentifikaci zaslán v hlavičce.

### 7. Code Review a diskuse
Poskytněte vyučujícímu code review.

---

## Failover steps pokud Vám nefunguje Docker

Nahraďte PostgreSQL databází in memory databází H2.

- V **build.gradle** nahraďte závislost **PostgreSQL Driver**:
```
runtimeOnly 'com.h2database:h2'
```
- V **application.properties** změňte [konfiguraci](https://www.baeldung.com/spring-boot-h2-database#database-configuration) pro připojení.

## Teachers notes

- Co je JSON
- Co je JWT token
- Jak implementovat JWT token